Facilitation Guide
@@@@@@@@@@@@@@@@@@
https://net.cybbh.io/public/networking/latest/index.html

Network Fundamentals
------------------
OSI Model
******
Physical (Layer 1 Physical Connections - Ethernet, Fiber, Radio Waves, etc)
Data Link (Layer 2 Communication - How the devices communicate, Internet version, etc)
Network (Layer 3 Internet Protocol - IPv4, IPv6, etc)
Transport (Layer 4 Protocols - TCP, UDP)
Session (Layer 5 How a sesion is working - NetBIOS, RPC, etc)
Presentation (Layer 6 File Formats - JPEG, PNG, etc)
Application (Layer 7 Specific Protocols - FTP, IMAP, Telnet, etc)

Physical Layer
^^^^^^

Data Link Layer
^^^^^^
MAC (Media Access Control) vs LLC (Logical Link Control)
Ethernet Header
******
First 7 bytes, Preamble
1 byte delimiter, SFD

Ethernet Frame
Destination MAC Address, Source MAC Address, Ethertype, Payload, CRC/FCS

Ethertype
******
0x0800 - IPv4
0x0806 - ARP
0x86DD - IPv6
0x8100 - VLAN Tag

VLAN Header
******
VLAN Tag between Source MAC Address and Ethertype
Tag Protocol ID - 0x8100 (16 bits)
PCP/DEI (4 bits)
VLAN ID (12 bits)

ARP Header
******
Hardware Type starts at Byte Offset 0, Protocol Type starts at Byte Offest 2
Security Concerns
++++
Does not require an ARP request
Host forcing an ARP reply until all hosts update ARP tables, creates a MitM attack


Network Layer
^^^^^^
IPv4 Headers
Default value of Version is 4
Default value of Header Length is 5
Header Length is number of words in IP Header
TTL - Windows only uses ICMP, Linux uses TCP with ICMP
Firewalking - Traceroute command, sending a request to devices that you are connected to, most are /30 subnets and are not accessible for the most part

Fragmentation
!!!!!!
If a packet is too big to send all at once it will fragment and send the data with different fragments so the receiver may receive the data properly
Reserve, Dont Fragment, More Fragment Bits followed by 13 fragment bits
MTU - (IHLx4) = Data Fragments
Offset increments by the amount of 8 bit chunks that can fit into the receiving end MTU

IPv6 Headers
Much less complicated than IPv4 Headers
No Fragmenting, no header checksum, no identification
Flow Label
Source Address and Destination Address are 128 bits long instead of 32 due to IPv6 being 128 bit long addressing
If fragmentation is needed the sender reaches out to the receiver, the receiver says that it needs fragmented and the sender will fragment before sending the data to the receiver

Fingerprinting
TTLs and TCP window size

ICMP Headers

IPv4 Address Auto-Configuration
APIPA
RFC 3927
APIPA Addresses are not routable and are 169.254.0.0/16 addresses

IPv6 Address Auto-Configuration
SLAAC (StateLess Address Auto-Configuration)
RFC 4862

Transport Layer
^^^^^^
Tells the system what kind of and what to open
TCP states (SYN, SYN/ACK, ACK)
Data is transfered using PSH/ACK
Closes using FIN/ACK

UDP Headers
******
Source Port, Destination Port, Length, and Checksum

Session Layer
^^^^^^
Protocols
******
SOCKS (Socket Secure)
NetBIOS
PPTP/L2TP
RPC

SOCKS 4/5
******
Will be used a lot for tunneling in this module

PPTP
******
Wireshark will break it down
Very old
Developed by Microsoft

L2TP
******
Developed by Microsoft and Cisco
Wireshark will read

SMB/CIFS
******
SMB rides over NetBIOS
NetBIOS ports
----
Dgram - UDP 138
Session - TCP 139

RPC
******
Request/response protocol
Makes system calls to connected device

Presentation Layer
^^^^^^
Translating
Formating
Encoding
Encryption
Compression

Application Layer
^^^^^^
FTP (TCP 20/21)
----
Direct interaction happens in Layer 7
2 modes - Active and Passive
FTP Active is default - You ask for the data but if they do not have the rights to access you then they are unable to get to you so you have to reach out for it
FTP Passive - the act of reaching out and grabbing the data that was requested by converging on a location (IP Address)

Complications with tunneling when using FTP, SSH tunnels normally use one port, FTP uses 2 different ports making the simple way of tunneling not possible
Uses a random high port to traverse

If using Passive mode, PASV will be present
retr <file>
stor <file>
<file> (10,10,10,10,128,4) 10.10.10.10:32772 ((128x256)+4) = 32772

SSH
----
TCP 25
Used for secure shell, scp, sftp, and a lot of other protocols
Used for tunnels
Asymmetric Difi-Helman Key Exchange
Symmetric for the session
Keys - User key, Host key, Session key
Known-Hosts Database - collection of host keys that are used for mutual authentication
Configuration file - settings that exist to configure ssh

Possible to steal the key needed to login to the ssh to the server, which requires rotation of the keys in order to prevent theft which also leads to the issue of keys being forgotten or lost

Telnet
----
Remote connection
Unsecure
Used for getting a shell

SMTP
----
Simple Mail Transfer Protocol
Uses port 25 to communicate with servers

TACACS
----
TCP 49
CISCO Remote Login service for switches and routers
Simple - Shows all data in the same section of the header
Extended - Has multiple results in the header
Wireshark will read most of it

HTTP(S)
----
TCP 80 (443)
GET/HEAD/POST/PUT
Hyper Text Transfer Protocol (Secure)
Status codes - 200 = good, 300 = it was moved, 400 = you did something wrong, 500 = server did something wrong

POP
----
TCP 110
You go to pick up your mail, downloading the mail

IMAP 
----
TCP 143
Able to read the information from the server

RDP
----
TCP 3389
Remote Desktop Protocol

DNS (QUERY/RESPONSE)
----
TCP/UDP 53
UDP is Query
TCP is Zone Transfers

DHCP
----
UDP 67/68
Server uses port 67, client uses port 68 when sending and receiving
Router Solicitation Multicast Address - FF02::2
Used for IP addressing

DHCPv4
Discover
Offers
Request
Acknowledge

DHCPv6
Solicit
Advertise
Request
Reply

TFTP 
----
UDP 69
No terminal

NTP 
----
UDP 123
Network Time Protocol

SNMP
----
UDP 161/162

RADIUS
----
UDP 1645/1646 AND 1812/1813

RTP 
----
UDP above 1023

Mathematics of Networking
------------------
Bits = 1 bit
Nibbles = 4 bits (Hex character also)
Bytes = 8 bits
Half Words = 16 bits
Words = 32 bits
Double Words = 64 bits
Quad Words = 128 bits

Base2 = Binary
Base10 = Decimal
Base16 = Hex
Base64 = Used for Encoding, +/.= are signs of Base64

Encapsulation and Decapsulation
------------------
Layers
******
Layer1 = Bit
Layer2 = Ethernet Frame
Layer3 = IP Packet
Layer4 = TCP Segment

Layer 2 Switching Technologies
------------------
Fast Forward - Only Destination MAC
Fragment Free - First 64 Bytes
Store and Forward - Entire Frame and FCS

CAM Table
----
Learn - Source MAC
Forward - Destination MAC

IEEE 802.1AD "Q-IN-Q"
----
VLANs inside of VLANs
0x88A8 or 0x9100
Standard Double Tag or Non-standard Double Tag

"Double Taggging" - Two VLAN IDs with the one in front of the other VLAN Tag being 0x8100

STP
----
Spanning Tree Protocol
Single point of failure
Prevents Broadcast Storms which send ARP requests to every device connected even if not directly connected. Exhausts all of the resources on the network until it goes down
Rapid Spanning Tree Protocol - surprisingly enough, it allows Spanning Tree Protocol only faster

DTP
----
Dynamic Trunking Protocol
Trunking - traffic for systems that need to know they are on a VLAN or are not on a VLAN, uses trunking ports

VTP
----
VLAN Trunking Protocol
Have a shit ton of VLANs and have a shit ton of switches, makes it so the administrator does not have to type in all of the VLAN information each time a switch or new VLAN is added
Provides a centralized VLAN configuration
Can be used against the network to cause chaos
Bridge Priority 0 = centralized VLAN/Bridge
Can very easily be taken down if given physical access, will take the plugged in switch's configuration and overwrite last configuration

Port Security
----
shutdown
restrict
protect
BPDU guard - when a new switch is plugged in the new switch will not connect to the old switch
Sticky MAC - will not allow connection to new MAC address

Layer 2 Discovery Protocols
----
Cisco Discovery Protocol (CDP)
Foundry Discovery Protocol (FDP)
Link Layer Discovery Protocol (LLDP)

Layer 3 Routing Technologies
------------------
Administrative Distance - Lower number, more trust
BGP uses path vector to decide what it is supposed to be using, using number of hops and time
Distance vector - RIP and EIGRP
Link-State - OSPF and IS-IS

BGP
------------------
Can be stolen by using illegitimate advertising of addresses
BGP propagates false information
Used to steal prefixes, monitoring traffic, intercept, 'black holing' traffic, perform MitM

Defending attacks
----
IP prefix filtering
BGP hijacking detection using TTL tracking, increased Round Trip Time, and monitoring misdirected traffic
BGPSec

Wireshark

TCPDump

BPFs









