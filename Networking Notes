Facilitation Guide
@@@@@@@@@@@@@@@@@@
https://net.cybbh.io/public/networking/latest/index.html
ssh student@10.50.27.42 -X (accessing necessary host in terminal)
credentials
student:password
vyos:password

CTFds 1
----
http://networking-ctfd-1.server.vta:8000/

Network Fundamentals
------------------
OSI Model
******
Physical (Layer 1 Physical Connections - Ethernet, Fiber, Radio Waves, etc)
Data Link (Layer 2 Communication - How the devices communicate, Internet version, etc)
Network (Layer 3 Internet Protocol - IPv4, IPv6, etc)
Transport (Layer 4 Protocols - TCP, UDP)
Session (Layer 5 How a sesion is working - NetBIOS, RPC, etc)
Presentation (Layer 6 File Formats - JPEG, PNG, etc)
Application (Layer 7 Specific Protocols - FTP, IMAP, Telnet, etc)

Physical Layer
^^^^^^

Data Link Layer
^^^^^^
MAC (Media Access Control) vs LLC (Logical Link Control)
Ethernet Header
******
First 7 bytes, Preamble
1 byte delimiter, SFD

Ethernet Frame
Destination MAC Address, Source MAC Address, Ethertype, Payload, CRC/FCS

Ethertype
******
0x0800 - IPv4
0x0806 - ARP
0x86DD - IPv6
0x8100 - VLAN Tag

VLAN Header
******
VLAN Tag between Source MAC Address and Ethertype
Tag Protocol ID - 0x8100 (16 bits)
PCP/DEI (4 bits)
VLAN ID (12 bits)

ARP Header
******
Hardware Type starts at Byte Offset 0, Protocol Type starts at Byte Offest 2
Security Concerns
++++
Does not require an ARP request
Host forcing an ARP reply until all hosts update ARP tables, creates a MitM attack


Network Layer
^^^^^^
IPv4 Headers
Default value of Version is 4
Default value of Header Length is 5
Header Length is number of words in IP Header
TTL - Windows only uses ICMP, Linux uses TCP with ICMP
Firewalking - Traceroute command, sending a request to devices that you are connected to, most are /30 subnets and are not accessible for the most part

Fragmentation
!!!!!!
If a packet is too big to send all at once it will fragment and send the data with different fragments so the receiver may receive the data properly
Reserve, Dont Fragment, More Fragment Bits followed by 13 fragment bits
MTU - (IHLx4) = Data Fragments
Offset increments by the amount of 8 bit chunks that can fit into the receiving end MTU

IPv6 Headers
Much less complicated than IPv4 Headers
No Fragmenting, no header checksum, no identification
Flow Label
Source Address and Destination Address are 128 bits long instead of 32 due to IPv6 being 128 bit long addressing
If fragmentation is needed the sender reaches out to the receiver, the receiver says that it needs fragmented and the sender will fragment before sending the data to the receiver

Fingerprinting
TTLs and TCP window size

ICMP Headers

IPv4 Address Auto-Configuration
APIPA
RFC 3927
APIPA Addresses are not routable and are 169.254.0.0/16 addresses

IPv6 Address Auto-Configuration
SLAAC (StateLess Address Auto-Configuration)
RFC 4862

Transport Layer
^^^^^^
Tells the system what kind of and what to open
TCP states (SYN, SYN/ACK, ACK)
Data is transfered using PSH/ACK
Closes using FIN/ACK

UDP Headers
******
Source Port, Destination Port, Length, and Checksum

Session Layer
^^^^^^
Protocols
******
SOCKS (Socket Secure)
NetBIOS
PPTP/L2TP
RPC

SOCKS 4/5
******
Will be used a lot for tunneling in this module

PPTP
******
Wireshark will break it down
Very old
Developed by Microsoft

L2TP
******
Developed by Microsoft and Cisco
Wireshark will read

SMB/CIFS
******
SMB rides over NetBIOS
NetBIOS ports
----
Dgram - UDP 138
Session - TCP 139

RPC
******
Request/response protocol
Makes system calls to connected device

Presentation Layer
^^^^^^
Translating
Formating
Encoding
Encryption
Compression

Application Layer
^^^^^^
FTP (TCP 20/21)
----
Direct interaction happens in Layer 7
2 modes - Active and Passive
FTP Active is default - You ask for the data but if they do not have the rights to access you then they are unable to get to you so you have to reach out for it
FTP Passive - the act of reaching out and grabbing the data that was requested by converging on a location (IP Address)

Complications with tunneling when using FTP, SSH tunnels normally use one port, FTP uses 2 different ports making the simple way of tunneling not possible
Uses a random high port to traverse

If using Passive mode, PASV will be present
retr <file>
stor <file>
<file> (10,10,10,10,128,4) 10.10.10.10:32772 ((128x256)+4) = 32772

SSH
----
TCP 25
Used for secure shell, scp, sftp, and a lot of other protocols
Used for tunnels
Asymmetric Difi-Helman Key Exchange
Symmetric for the session
Keys - User key, Host key, Session key
Known-Hosts Database - collection of host keys that are used for mutual authentication
Configuration file - settings that exist to configure ssh

Possible to steal the key needed to login to the ssh to the server, which requires rotation of the keys in order to prevent theft which also leads to the issue of keys being forgotten or lost

Telnet
----
Remote connection
Unsecure
Used for getting a shell

SMTP
----
Simple Mail Transfer Protocol
Uses port 25 to communicate with servers

TACACS
----
TCP 49
CISCO Remote Login service for switches and routers
Simple - Shows all data in the same section of the header
Extended - Has multiple results in the header
Wireshark will read most of it

HTTP(S)
----
TCP 80 (443)
GET/HEAD/POST/PUT
Hyper Text Transfer Protocol (Secure)
Status codes - 200 = good, 300 = it was moved, 400 = you did something wrong, 500 = server did something wrong

POP
----
TCP 110
You go to pick up your mail, downloading the mail

IMAP 
----
TCP 143
Able to read the information from the server

RDP
----
TCP 3389
Remote Desktop Protocol

DNS (QUERY/RESPONSE)
----
TCP/UDP 53
UDP is Query
TCP is Zone Transfers

DHCP
----
UDP 67/68
Server uses port 67, client uses port 68 when sending and receiving
Router Solicitation Multicast Address - FF02::2
Used for IP addressing

DHCPv4
Discover
Offers
Request
Acknowledge

DHCPv6
Solicit
Advertise
Request
Reply

TFTP 
----
UDP 69
No terminal

NTP 
----
UDP 123
Network Time Protocol

SNMP
----
UDP 161/162

RADIUS
----
UDP 1645/1646 AND 1812/1813

RTP 
----
UDP above 1023

Mathematics of Networking
------------------
Bits = 1 bit
Nibbles = 4 bits (Hex character also)
Bytes = 8 bits
Half Words = 16 bits
Words = 32 bits
Double Words = 64 bits
Quad Words = 128 bits

Base2 = Binary
Base10 = Decimal
Base16 = Hex
Base64 = Used for Encoding, +/.= are signs of Base64

Encapsulation and Decapsulation
------------------
Layers
******
Layer1 = Bit
Layer2 = Ethernet Frame
Layer3 = IP Packet
Layer4 = TCP Segment

Layer 2 Switching Technologies
------------------
Fast Forward - Only Destination MAC
Fragment Free - First 64 Bytes
Store and Forward - Entire Frame and FCS

CAM Table
----
Learn - Source MAC
Forward - Destination MAC

IEEE 802.1AD "Q-IN-Q"
----
VLANs inside of VLANs
0x88A8 or 0x9100
Standard Double Tag or Non-standard Double Tag

"Double Taggging" - Two VLAN IDs with the one in front of the other VLAN Tag being 0x8100

STP
----
Spanning Tree Protocol
Single point of failure
Prevents Broadcast Storms which send ARP requests to every device connected even if not directly connected. Exhausts all of the resources on the network until it goes down
Rapid Spanning Tree Protocol - surprisingly enough, it allows Spanning Tree Protocol only faster

DTP
----
Dynamic Trunking Protocol
Trunking - traffic for systems that need to know they are on a VLAN or are not on a VLAN, uses trunking ports

VTP
----
VLAN Trunking Protocol
Have a shit ton of VLANs and have a shit ton of switches, makes it so the administrator does not have to type in all of the VLAN information each time a switch or new VLAN is added
Provides a centralized VLAN configuration
Can be used against the network to cause chaos
Bridge Priority 0 = centralized VLAN/Bridge
Can very easily be taken down if given physical access, will take the plugged in switch's configuration and overwrite last configuration

Port Security
----
shutdown
restrict
protect
BPDU guard - when a new switch is plugged in the new switch will not connect to the old switch
Sticky MAC - will not allow connection to new MAC address

Layer 2 Discovery Protocols
----
Cisco Discovery Protocol (CDP)
Foundry Discovery Protocol (FDP)
Link Layer Discovery Protocol (LLDP)

Layer 3 Routing Technologies
------------------
Administrative Distance - Lower number, more trust
BGP uses path vector to decide what it is supposed to be using, using number of hops and time
Distance vector - RIP and EIGRP
Link-State - OSPF and IS-IS

BGP
------------------
Can be stolen by using illegitimate advertising of addresses
BGP propagates false information
Used to steal prefixes, monitoring traffic, intercept, 'black holing' traffic, perform MitM

Defending attacks
----
IP prefix filtering
BGP hijacking detection using TTL tracking, increased Round Trip Time, and monitoring misdirected traffic
BGPSec

Traffic Sniffing/Capture
------------------
Need a capture library to capture network traffic
Libpcap
WinPcap
NPCAP

Wireshark
------------------

TShark
------------------
CLI version of wireshark

TCPDump
------------------
sudp tcpdump -D (shows all available listening devices)
sudo tcpdump -i etho0 (captures the traffic from eth0) -X (packet data with Hex and ASCII) -XX (packet data with Hex and ASCII with Ethernet Frame as well) -vv (verbose) -n (not relying on the system to convert IP to hostnames)
sudo tcpdump -i etho0 -XXvvn 'not tcp port 22' (forces tcpdump to not show tcp port 22)
sudo tcpdump -i eth0 -XXvvn '(not tcp port 22) && (udp port 68)' (forces tcpdump to show port 68 and not tcp port 22)
sudo tcpdump -i eth0 -XXvvn '10.10.0.40 && not tcp port 22' (forces tcpdump to show all connections that are not on port 22 from 10.10.0.40)
sudo tcpdump -XXvvnr (tells tcpdump to read from a file) /home/activity_resources/pcaps/Xtra.pcap
sudo tcpdump -i eth0 -XXvvnw (tells tcpdump to write to a file) file.pcap

BPFs
------------------
Berkeley Packet Filters
Allow for the filtering of traffic

tcpdump {A} [B:C] {D} {E} {F} {G}

A = Protocol (ether | arp | ip | ip6 | icmp | tcp | udp)
B = Header Byte offset
C = optional: Byte Length. Can be 1, 2 or 4 (default 1)
D = optional: Bitwise mask (&)
E = Operator (= | == | > | < | <= | >= | != | () | << | >>)
F = Result of Expresion
G = optional: Logical Operator (&& ||) to bridge expressions

Example: 
tcpdump 'ether[12:2] = 0x0800 && (tcp[2:2] != 22 && tcp[2:2] != 23)'

Bitwise Masking
Filter by bits and not just the bytes

Most Exclusive
All designated bit values must be set; no others can be set
tcp[13] = 0x11 or tcp[13] & 0xFF = 0x11
0x11
0x12 - SYN/ACK
0x28 - PSH/URG
Can also use decimal to represent the numbers needed to filter on

DSCP x 4

Less Exclusive
All desginated bits must be set; all other may be set
tcp[13] & 0x11 = 0x11

Least Exclusive
At least one of the designated bits must be set to not equal 0; all other may be set
tcp[13] & 0x11 != 0

ip[6]&0x20 = 0x20||ip[6:2]&0x1FFF > 0||ip[12:4]&0xFFFFFF00=0x0A0A2800

N3tw0rkFund3m3nt@ls
P@cket_C@rv1ng
Wh@t_P@load?
N3tw0rkBPF

Networking - 1 - Fundamentals - Task 1 - Frame and Packet Headers
\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////

MAC of ARP Storm
----
00:07:0d:af:f4:54

MAC of 10.10.10.1
----
00:1d:09:f0:92:ab

MAC of 10.10.10.2
----
00:1a:6b:6c:0c:cc

MAC of system trying to perform ARP MitM attack
----
fa:16:3e:35:21:5a

What is the OP code of a RARP Request?
----
3

What is the OP code of a RARP Response?
----
4

What is the RARP Requestor's MAC?
----
00:0c:29:34:0b:de

What was the RARP requestor’s resolved IP address?
----
10.1.1.100

What is the MAC of the system spamming gratuitous ARP’s for 192.168.1.254?
----
00:00:5e:00:01:01

What is the software version of the Cisco Switch IOS (copy entire field “as is” from Wireshark)?
----
IOS (tm) C2950 Software (C2950-I6K2L2Q4-M), Version 12.1(22)EA14, RELEASE SOFTWARE (fc1)

What is the software version of the Cisco Router (copy entire field “as is” from Wireshark)?
----
IOS (tm) 1600 Software (C1600-NY-L), Version 11.2(12)P, RELEASE SOFTWARE (fc1)

What is the System Name of one of the LLDP sending devices?
----
S2.cisco.com

What is the Bridge Priority of the STP Root Bridge?
----
0

What is the MAC address of the STP Root Bridge?
----
00:1f:27:b4:7d:80

What is the VTP Management Domain Name?
----
cisco

What is the latest configuration revision number?
----
11

How many total VLANs are being advertised via VTP?
----
22

What is the message contained within the single tagged VLAN traffic coming from 11.22.33.44?
----
I pitty the foo

What is the VLAN ID of this traffic?
----
999

What is the VLAN ID being attacked by 10.10.10.10 using Double Tagging?
----
250

What is the combined message being sent via ICMP?
----
Wouldn't you like too be a Pepper Too!

What is the OS of 192.168.1.1 host based off its Echo Request message to the Google DNS?
----
Linux

What is the message that 192.168.65.20 sending to Google's DNS via ICMP?
----
Exsqueeze me?

How many Hops away is the 151.101.64.84 address?
----
11

What is the IP ID of the fragmented ICMP packet? (starting at packet 6472)
----
46544

What is the offset value of the fragments?
----
122

What is the possible OS of the system that sent this ICMP based on the message payload?
----
Windows

What is the ICMPv6 type number of Echo Request?
----
128

What is the ICMPv6 type number of Echo Reply?
----
129

What is the ICMPv6 type number of the Router Advertisement message?
----
134

What is the link-layer address of the advertising router?
----
fa:16:3e:35:21:5a

What is the IPv6 prefix being advertised?
----
beef:4:f00d::

What is the HSRP virtual IP?
----
192.168.0.1

What is the HSRP multicast address used?
----
224.0.0.2

What is the IP address of the HSRP Active forwarder (before the takeover)?
----
192.168.0.30

What is the IP address of the HSRP Active forwarder (after the takeover)?
----
192.168.0.10

What is the VRRP multicast address used?
----
224.0.0.18

What is the VRRP virtual IP?
----
192.168.1.254

How many total devices are communicating via VRRP?
----
3

How many networks are being advertised via RIP?
----
2

What are the networks being advertised (in numeric order separated by commas and no spaces)?
----
200.0.1.0,200.0.2.0

What protocol and port is being used for RIP?
----
UDP 520

What network is being advertised via EIGRPv4
----
192.168.4.0/24

What is the IP protocol number used for EIGRP?
----
88

What multicast address is used to send EIGRPv4 updates?
----
224.0.0.10

What network is being advertised via EIGRPv6
----
2001:db8:0:400::/64

What multicast address is used to send EIGRPv6 updates?
----
ff02::a

What Autonomous system number is being used?
----
100

What is the IP protocol number used for OSPF?
----
89

What is the IP address of the OSPF designated router (DR)?
----
192.168.170.8

What multicast address is used by the DR to send updates?
----
224.0.0.5

How many networks are being advertised via BGP?
----
3

What are the networks being advertised (in numeric order separated by commas and no spaces)?
----
10.0.0.0/8,172.16.0.0/16,192.168.4.0/22

What Autonomous system number is the 192.168.0.10 peer in?
----
65210

What Protocol and port is being used for BGP?
----
TCP 179

Networking - 1 - Fundamentals - Task 2 - Packet Payloads
\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////
What Protocol and port is being used for SMB?
----
TCP 445

What is the name of the file accessed via SMB?
----
putty.exe

What is the IP address of the DHCP server?
----
192.168.0.1

What is the “offered” IP address?
----
192.168.0.10

What is the DHCP lease time (in seconds)?
----
3600

What ".com" webpage was the “A” record requested for?
----
microsoft.com

What webpage was the “AAAA” record requested for?
----
wikipedia.org

What mail server was the “MX” record requested for?
----
hotmail.com

What domain was the Zone transfer requested for?
----
etas.com

What is the username/password used for the FTP authentication?
----
student10/password10

What was the filename requested via FTP?
----
DO_NOT_LOOK.txt

What was the message in the file transferred via FTP?
----
Schrodinger's Cat

What was the source and destination ports used for the Passive FTP (SPORT:DPORT)?
----
38591:42452

What was the HTTP site reached (without any errors or redirects)?
----
www.faqs.org

What was the HTTP site that was “Moved Temporarily”?
----
https://snippets.cdn.mozilla.net/us-west/bundles/bundle_6fdbf7e26c281d58ce9687293f922ec1607595bb.json

What was the HTTP site that was “Moved Permanently”?
----
https://msn.com/

What was the HTTPs (TLS) site that was reached?
----
twitter.com

What is the SMTP domain name?
----
virginmedia.com

Who sent the email to (cuizw@public.qd.sd.cn)?
----
owadomyi2897@virginmedia.com

From the message, what are “self-explanatory”?
----
sizes

What is the name of the SMTP server communicating over IPv6?
----
mx.google.com

What is the username that signed-in via IMAP?
----
neulingern

How many emails were "fetched"?
----
13

Who is “reporting a similar situation” via the emails?
----
Jerry Hammons

What is the POP mailbox address?
----
digitalinvestigator@networksims.com

How many messages does this mailbox have?
----
3

What is the name of the University in one of the email messages?
----
Edinburgh Napier University

What is the IP of the NTP server?
----
192.168.50.50

What is the Timestamp in the NTP messages (MONTH DAY, YEAR)?
----
Sep 27, 2004

What is the NTP version number?
----
3

What is the SSH server IP address?
----
172.16.40.10

What is the SSH protocol version being used by both (copy entire field “as is” from Wireshark)?
----
SSH-2.0-OpenSSH_7.9p1 Debian-10+deb10u2

Which asymmetric encryption protocol is being used?
----
Diffie-Hellman

What is the MSS option set to for the SSH communication?
----
1410

What is the windows scale shift option set to?
----
7

What is the username/password of the account used via telnet?
----
fake/user

What is the exact first command issued on the remote system over telnet?
----
/sbin/ping www.yahoo.com

What was the second command issued?
----
ls

What is the inital sequence number of the client?
----
2579865836

What is the MSS of the server?
----
1448

What was the username used to log in via RADIUS
----
John.McGuirk

What is the RADIUS Request code?
----
1

What is the RADIUS Accept code?
----
2

What is the RADIUS Challenge code?
----
11

What is the IP of the TACACS+ server?
----
192.168.1.5

What is the Source port used for the communication?
----
59087

What is the Maximum Segment Size (MSS) option set to for the TACACS+ communication?
----
1460

What is the starting window size of the TACACS+ client?
----
4128

What SNMP version is being used?
----
3

What is the IPv4 address of the SNMP server?
----
10.0.0.150

What is the IPv6 address of the SNMP server?
----
2001:470:e5bf:1001:1cc7:73ff:65f5:a2f7

What Protocol and port is being used for SNMP communication?
----
UDP 161

What is the IP address of the TFTP server?
----
192.168.0.13

What is the name of the file uploaded to the TFTP server?
----
rfc1350.txt

How many TFTP “Blocks” were used to send the file?
----
49

Networking - 1 - Fundamentals - Task 3 - Basic Analysis
\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////
What is the Berkeley Packet Filter, using tcpdump, to capture all packets with a ttl of 64 and less, utilizing the IPv4 or IPv6 Headers?
----
ip[8]<=0x40||ip6[7]<=0x40

What is the Berkeley Packet Filter, using tcpdump, to capture all IPv4 packets with at least the Dont Fragment bit set?
----
ip[6]&0x40=0x40

What is the Berkeley Packet Filter, using tcpdump, to capture traffic with a Source Port higher than 1024, utilizing the correct Transport Layer Headers?
----
tcp[0:2]>0x400||udp[0:2]>0x400

What is the Berkeley Packet Filter, using tcpdump, to capture all Packets with UDP protocol being set, utilizing the IPv4 or IPv6 Headers?
----
ip[9]=0x11||ip6[6]=0x11

What is the Berkeley Packet Filter, using tcpdump, to capture only packets with the ACK/RST or ACK/FIN flag set, utilizing the correct Transport Layer Header?
----
tcp[13]=0x11||tcp[13]=0x14

What is the Berkeley Packet Filter, using tcpdump, to capture all packets with an IP ID field of 213?
----
ip[4:2]=0xD5

What is the Berkeley Packet Filter, using tcpdump, to capture all traffic that contains a VLAN tag?
----
ether[12:2]=0x8100

What is the Berkeley Packet Filter, using tcpdump, to capture all IPv4 packets relating to DNS?
----
tcp[0:2]=0x35||tcp[2:2]=0x35||udp[0:2]=0x35||udp[2:2]=0x35

What is the Berkeley Packet Filter, using tcpdump, to capture the initial packets from a client trying to initiate a TCP connection?
----
tcp[13]=0x02

What is the Berkeley Packet Filter, using tcpdump, to capture the response packets from a server listening on an open TCP ports?
----
tcp[13]=0x12

What is the Berkeley Packet Filter, using tcpdump, to capture the response packets from a server with closed TCP ports?
----
tcp[13]=0x04

What is the Berkeley Packet Filter, using tcpdump, to capture all TCP and UDP packets sent to the well known ports?
----
tcp[2:2]<1024||udp[2:2]<1024

What is the Berkeley Packet Filter, using tcpdump, to capture all HTTP traffic?
----
tcp[0:2]=0x50||tcp[2:2]=0x50

What is the Berkeley Packet Filter, using tcpdump, to capture all telnet traffic?
----
tcp[0:2]=0x17||tcp[2:2]=0x17

What is the Berkeley Packet Filter, using tcpdump, to capture all ARP traffic?
----
ether[12:2]=0x0806

What is the Berkeley Packet Filter, using tcpdump, to capture if the "Evil bit" is set?
----
ip[6]&0x80=0x80

What is the Berkeley Packet Filter, using tcpdump, to capture any packets containing the CHAOS protocol within an IPv4 header?
----
ip[9]=0x10

What is the Berkeley Packet Filter, using tcpdump, to capture all IPv4 packets with the DSCP field of 37?
----
ip[1]&0xFC=0x94

What is the Berkeley Packet Filter, using tcpdump, to capture all IPv4 packets targeting just the beginning of potential traceroutes as it's entering your network. This can be from a Windows or Linux machine using their default settings?
----
ip[8]=1&&(ip[9]=0x01||ip[9]=0x11)

What is the Berkeley Packet Filter, using tcpdump, to capture all packets where the URG flag is not set and URG pointer has a value?
----
tcp[13]&0x20=0&&tcp[18:2]>0

What is the Berkeley Packet Filter, using tcpdump, to capture a TCP null scan to the host 10.10.10.10?
----
tcp[13]=0&&ip[16:4]=0x0A0A0A0A

What is the Berkeley Packet Filter, using tcpdump, to capture an attacker using vlan hopping to move from vlan 1 to vlan 10?
----
ether[12:4]&0xFFFF0FFF=0x81000001&&ether[16:4]&0xFFFF0FFF=0x8100000A

Packet Creation and Socket Programming
%%%%%%%%%%%%%%%%%%%%%%%%%
Socket Types
-------------------
Stream Sockets
----
Connection oriented and sequenced, methods for connection TCP, SCTP, and Bluetooth

Datagram Sockets
----
Connectionless, UDP

Raw Sockets
----
Direct sending and receiving of IP packets without protocol specific formatting

User Space vs Kernel Space Sockets
------------------
User Space Sockets
----
Stream Sockets
Datagram Sockets

Kernel Space Sockets
----
Raw Sockets

Socket Creation
-----------------
User Space Sockets - Most common sockets that do not require elevated privileges
^^^^
tcpdump or wireshark
netcat above well known port range
nmap with no switches

Kernel Space Sockets - Attemps to access hardware directly on behalf of a user application
^^^^
tcpdump or wireshark
nmap for OS identification
netcat in well known port range


Network Sockets primarily use the Python3 Socket library and socket.socket function
-------------------
Family
****
AF_INET = IPv4
AF_INET6 = IPv6
AF_UNIX = Program to program interaction

Type
****
SOCK_STREAM = TCP
SOCK_DATAGRAM = UDP
SOCK_RAW = RAW

Protocol
****
IPPROTO_RAW = RAW

import socket
  s = socket.socket(socket.<FAMILY>, socket.<TYPE>, socket.<PROTOCOL>)

RAW IPv4 Sockets
^^^^
Raw Socket scripts must include the IP header and next headers
Used for testing defenses such as triggering and IDS
Used also to bypass firewalls

Network Reconnaissance
----------------------
Active - Internal (DNS Queries, ARP Requests), External (Network Scanning)
Passive - Internal (Packet Sniffers), External (DNS Lookups, Whois, Job Site Listings)
Internal
External

Passive - Gathering information without direct interaction, lower risk
----
Involves identifying IP Addresses and sub-domains, external and 3rd party sites, people and technologies, content of interest, vulnerabilities
Tools - WHOIS Queries, job site listings, phone numbers, google searches, passive OS fingerprinting

Passive External Network Reconnaissance
----
Resolves hostnames to IP Addresses
RFC 3912
WHOIS queries

Dig
****
Typically between primary and secondary DNS servers
If allowed to transfer externally hostnames, IPs, and IP blocks can be determined

AXFR = Zone Transfers

Zone Transfers
****
Return DNS information
supplements base queries

WHOIS Queries
****
Can use the internet wayback machine if the domain is old, could reveal potential information that has since been removed but was captured

Google Searches
****
Research

SHODAN
****
Search engine for internet-connected devices
Reveals information about technologies, remote access services, improperly configured services, and network infrastructure
When selected can give additional information and applicable vulnerabilities

Network Scanning
-------------------
Scanning Strategy
----
Remote to Local - Outside to In
Local to Remote
Local to Local
Remote to Remote

Scanning Approach
----
Aim
****
Wide range target scan
Target specific scan

Method
****
Single source scan
Distributed scan

Methods
----
Broadcast ping and ping sweep
ARP scan
SYN scan
Full scan
NUll scan
FIN scan
XMAS scan
UDP scan

NMap options
----------------
-sU - UDP
-sS - SYN
-n - disable name resolution
--min-rate <NUM> how many packets to send per second
-vv - verbose
-T4 - speed up scan without dropping packets
-Pn - "treat this target as if its up
-A - all information
-p - ports scanned (1-1024, scans 1-1024, -1024m scans first available number)
-p- - scans all ports

Netcat
----------------
-nc -nzvw1
-1 sec
-no name resolution
-verbose
-wait

nc <IP> 22 - if SSH shows, it is banner grabbig
Trust but verify

NETWORK SCAN SCRIPT 
\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////
#!/bin/bash
echo "Enter network address (e.g. 192.168.0): "
read net
echo "Enter starting host range (e.g. 1): "
read start
echo "Enter ending host range (e.g. 254): "
read end
echo "Enter ports space-delimited (e.g. 21-23 80): "
read ports
for ((i=$start; $i<=$end; i++))
do
    nc -nvzw1 $net.$i $ports 2>&1 | grep -E 'succ|open'
done
# (-v) running verbosely (-v on Linux, -vv on Windows),
# (-n) not resolving names. numeric only IP(no D.S)
# (-z) without sending any data. zero-I/O mode(used for scanning)
#(-w1) waiting no more than 1second for a connection to occur
# (2>&1) redirect STDERR to STDOUT. Results of scan are errors and need to redirect to output to grep
# (-E) Interpret PATTERN as an extended regular expression
# ( | grep open) for Debian to display only open connections
# ( | grep succeeded) for Ubuntu to display only the open connections

Make web requests with Linux
------------------
curl
wget -r (-r for recursive) <Protocol>://<IP>:<Port>

Situational Awareness Checklist
------------------
Hostname / uname -a
Whoami, w
Directory (pwd)
sudo -l
cat /etc/services, /etc/hosts
ps -elf
netstat -ano or -ntlpu (no resolution, tcp, listening, process id, udp) / ss -ntlpu
ipconfig / ifconfig / ip addr or ip a
arp -a / ip neighbor / ip n
ip route / ip r / route
check any other directories as directed / important directories

Ruby Ping sweep
for i in {1..254} ;do (ping -c 1 192.168.1.$i | grep "bytes from" &) ;done

after 21-23,80 scan 1-9999

Data Transfer, Movement, and Redirection
--------------------
TFTP - Trivial File Transfer Protocol 
  No shell
FTP
  Active
    The data comes to you
  Passive
    You go get the data
SFTP - SSH File Transfer Protocol
  Uses port 22 using SSH, gives a terminal, encrypted and secure

SCP - Secure Copy
  uses port 22
  uses SSH
  noninteractive
  Syntax:
    scp <options> <source> <destination>
    scp -P<port> -r(recursive) -3(3 way communication)
    scp file.txt(relative path) <username>@<IP>:<directory>
    scp <user>@<IP>:/etc/ssh/sshd_config . (saves sshd_config to current directory)

FTPS - File Transport Protocol Secure
  TCP transport port 443
  SSL/TLS encryption to FTP
  Interactive terminal access

Traffic Redirection
--------------------
Netcat
  Syntax:
    Client to Listener
      nc <IP> <port> < <file> (sending)
      nc -lp <port> > <file> (receiving)
    Listener to Client
      nc -lp <port> < <file>
      nc <IP> <port> > <file>

mkfifo <pipe name>
<command> > <pipe name>

Host functioning as relay:
<nc command> 0< mypipe | <nc command> 1> mypipe

SSH Tunneling
---------------------
creating new channels using SSH-CONN protocol
allows for tunneling of other services through SSH
provides insecure services encryption

SSH Local Port Forwarding
---------------------
ssh -p <optional alt port> <user>@<pivot ip> -L <local bind port>:<target ip>:<target port>
or
ssh -L <local port>:<target ip>:<target port> -p <alt port> <user>@<pivot ip> -NT

SSH Remote Port Forwarding
---------------------
ssh -p <optional alt port> <user>@<remote ip> -R <remote bind port>:<target ip>:<target port> -NT
or
ssh -R <remote bind port>:<target ip>:<target port> -p <optional alt port> <user>@<remote ip> -NT

nmap <IP>
nc <IP> <port> - shows what service is running on the port

wget -r ftp://<IP>:22(alternate port)
Creates a folder called <IP>:22 on the local host

ssh <found username>@<IP> -p 25 -L 50200:127.0.0.1:80(open port on the example machine) -NT (terminal does not accept more input)
ssh <user>@InternetHost -R 50299:127.0.0.1:80(open port on the example machine) -NT
wget -r 127.0.0.1:50200 or 50299 (makes the directory 127.0.0.1:50200 on local machine)
#####################################################
###                                               ###
###                  TUNNELING                    ###
###                                               ###
#####################################################
ssh <user>@<IP> -p 25 -D 9050 -NT
proxychains <nmap> -Pn Jerry, Thomas (hostnames)
Jerry - 21, 22, 23, 80 (open ports)
Thomas - 23, 80 (open ports)
Joe - 22, 80, 443
proxychains wget -r ftp://Jerry (sends through the tunnel created with 9050)
Creates Jerry directory on local machine
proxychains wget -r Jerry
Sends information to Jerry directory
proxychains wget -r Thomas
Creates Thomas directory on local machine
proxychains telnet Jerry (gives access to Jerry)

ssh <user>@<IP>(first box accessed) -p 25 -R 50298:127.0.0.1:22 -NT
ssh <user>@<IP>(Bob) -p 25 -L 50201:127.0.0.1:50298 -NT
nc 127.0.0.1 50201 (to check tunnels)
ssh <user>@127.0.0.1 -pp 50201 (gives access to Jerry) -D 9050 (close old connection) -NT
ssh <user>@Bob -p 25 -L 50202:Jerry:23 -NT
telnet 127.0.0.1 50202
ssh <user>@Bob -p 25 -R 50298:127.0.0.1:22 -NT
ssh <user>@127.0.0.1 -p 50201 (gives access to Jerry) -D 9050 -NT
proxychains <nmap -Pn Joe or ./scan.sh>
proxychains nc Joe (22)(80)(443) (22 - SSH, 80 - Telnet, 443 - FTP)
proxychains wget -r ftp://Joe:443 (Creates Joe:443 directory on local machine)
#####################################################
###                                               ###
###                END OF TUNNELING               ###
###                                               ###
#####################################################

50200-50299 - ports
L ->    <-R

Network Analysis
------------------------
Fingerprinting
----
Passive OS Fingerprinting
  /etc/p0f/p0f.fp
p0f -i eth0 (command)
tcpdump port 80 -w wget.pcap - write tcpdump port 80 results to a file named wget.pcap
p0f -r wget.pcap - read command for file that was created
p0f -r wget.pcap -o /var/log/p0f.log - reads results and sends them to p0f.log
cat /var/log/p0f.log | grep "mod=syn" - grep for SYN packets
cat /var/log/p0f.log | grep "mod=syn" | grep "subj=cli" - grep for SYN packets from the client

Baselining
----
Snapshot of what the network looks like during a time frame
No industry standard
7 days is the baseline - shows what is supposed to happen on a work day and what is supposed to happen on a non-work day

Network Data Types
----
Full Packet capture data - PCAPS
Session Data
Statistical Data
Packet String Data
Alert Data
Log Data

MitM attacks are caused by gratuitous replies

Network Filtering
----------------------
Practical applications for filtering
----
email addresses - to block unwanted email and increase productivity
computer applications in an organization environment - for security from vulnerable software
MAC filtering - also for security
Network traffic

Devices used to filter traffic
----
Firewall
IDS (Intrustion Detection Systems)

Filtering Concepts
----
Whitelist vs Blacklist (Allowed vs disallowed)

Network Device Operations
----
Routed - specific firewall IP
Transparent - 

Filtering Device Placement - as close to where the packets will be coming from as possible

                ##############
              ##              ##
            ##                  ##
          ##      #         #     ##
          ##                      ##
          ##           >          ##
          ##                      ##
            ##     #########     ##
              ##              ##
                ##############




                      #####
                    #  -  - #
                   #     >   #
                    #  ---- #
                      #####
                   \    |    /
                     \  |  /
                       \|/
                        |
                        |
                        |
                      /   \
                    /      \
                  /          \

iptables - IPv4 packet administration
ip6tables - IPv6 packet administration
ebtables - Ethernet Bridge frame table administration
arptables - arp packet administration

filter - default table. Provides packet filtering.
    INPUT, FORWARD, and OUTPUT

nat - used to translate private ←→ public address and ports.
    PREROUTING, POSTROUTING, and OUTPUT

mangle - provides special packet alteration. Can modify various fields header fields.
    All Chains: PREROUTING, POSTROUTING, INPUT, 

raw - used to configure exemptions from connection tracking.
    PREROUTING and OUTPUT

security - used for Mandatory Access Control (MAC) networking rules.
    INPUT, FORWARD, and OUTPUT

-A - append
-I - Insert
-D - delete
-L - list
-P - changes the default policy
-p - list a protocol
--sport or --dport - address a specfic port number
-d - destination address
-s - source address
-j - jump to target action
-n - displays port number
-t - specifies a table
--line numbers - prints the rule number

Table Flush
iptables -t [table] -F

Default policy change
iptables -t [table] -P [chain][action]

List rules with rule numbers
iptables -t [table] -L --line-numbers

Lists rules as commands interpreted by the system
iptables -t [table] -S

Inserts rule before Rule number
iptables -t [table] -I [chain] [rule num] [rules] -j [action]

Deletes rule at number
iptables -t [table] -D [chain] [rule num]

NFTables
    ip - IPv4 packets
    ip6 - IPv6 packets
    inet - IPv4 and IPv6 packets
    arp - layer 2
    bridge - processing traffic/packets traversing bridges.
    netdev - allows for user classification of packets - nftables passes up to the networking stack
    (no counterpart in iptables)

There are only 3 chain types
    filter - to filter packets - can be used with arp, bridge, ip, ip6, and inet families
    route - to reroute packets - can be used with ip and ipv6 families only
    nat - used for Network Address Translation - used with ip and ip6 table families only

nft add table [family] [table]
[family] = ip, ip6, inet, arp, bridge and netdev.
[table] = user provided name for the table.

nft add chain [family] [table] [chain] { type [type] hook [hook]
    priority [priority] \; policy [policy] \;}
[chain] = User defined name for the chain.
[type] =  can be filter, route or nat.
[hook] = prerouting, ingress, input, forward, output or
         postrouting.
[priority] = user provided integer. Lower number = higher
             priority. default = 0. Use "--" before
             negative numbers.
; [policy] ; = set policy for the chain. Can be
              accept (default) or drop.
 Use "\" to escape the ";" in bash

nft add rule [family] [table] [chain] [matches (matches)] [statement]
[matches] = typically protocol headers(i.e. ip, ip6, tcp,
            udp, icmp, ether, etc)
(matches) = these are specific to the [matches] field.
[statement] = action performed when packet is matched. Some
              examples are: log, accept, drop, reject,
              counter, nat (dnat, snat, masquerade)

nft {list | flush} ruleset
nft {delete | list | flush } table [family] [table]
nft {delete | list | flush } chain [family] [table] [chain]

nft list table [family] [table] [-a]
    Adds after position
    nft add rule [family] [table] [chain] [position <position>] [matches (matches)] [statement]
    Inserts before position
    nft insert rule [family] [table] [chain] [position <position>] [matches (matches)] [statement]
    Replaces rule at handle
    nft replace rule [family] [table] [chain] [handle <handle>] [matches (matches)] [statement]
    Deletes rule at handle
    nft delete rule [family] [table] [chain] [handle <handle>]

Terminator ports
6010,6011,6012















































